# Dockerfile.build

# 1) 베이스가 되는 Lambda Python 3.12 컨테이너
FROM public.ecr.aws/lambda/python:3.12 AS base

# 2) Layer 빌드 스테이지
FROM base AS layer-builder
RUN pip install --upgrade pip \
 && pip install fastapi pydantic openai tiktoken -t /layer/python
WORKDIR /layer
RUN zip -9 -r /layer.zip python

# 3) Function 빌드 스테이지
FROM base AS func-builder
RUN pip install --upgrade pip \
 && pip install -r requirements.txt -t /package
COPY app /package/app
WORKDIR /package
RUN zip -9 -r /function.zip .
